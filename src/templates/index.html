{% extends "layout.html" %}

{% block title %}
citation app
{% endblock %}

{% block body %}

<h1>citation app</h1>

<div>
  <a href="/new_citation"><button type="button">Create new citation</button></a>
</div>

{% if tags %}
<form action="/" method="get">
    <label>Filter by tags:</label><br>

    {% for tag in tags %}
        <input type="checkbox"
               name="tag"
               value="{{ tag }}"
               {% if selected_tags and tag in selected_tags %}checked{% endif %}>
        {{ tag }} <br>
    {% endfor %}
    
    <button type="submit">Filter</button>
</form>
{% endif %}

<hr>

{% if book_citations %}
  <h3>Added citations:</h3>
  <form action="/delete_citations" method="post" class="delete_citations">
    {% for citation in book_citations %}

    {% if citation.type == 'book' %}
      <li class="citation">
        <b>{{ citation.type }}</b> <br>
        {% if citation.tags %}
          Tags:
          {% for tag in citation.tags %}
            {{ tag }}{% if not loop.last %}, {% endif %}
          {% endfor %} <br>
        {% endif %}
        {{ citation.author }}. <em>{{ citation.title }}.</em> {{ citation.publisher }}, {{ citation.year }}. ISBN {{ citation.isbn }}
        <input type="checkbox" name="citation_id" value="{{ citation.id }}" class="checkbox"> |
        <a href="/edit_citation/{{ citation.id }}"><button type="button">Edit</button></a>
      </li>
      <hr />

    {% elif citation.type == 'inproceedings' %}
      <li class="citation">
        <b>{{ citation.type }}</b> <br>
        {% if citation.tags %}
          Tags:
          {% for tag in citation.tags %}
            {{ tag }}{% if not loop.last %}, {% endif %}
          {% endfor %} <br>
        {% endif %}
        {{ citation.author }}. <em>{{ citation.title }}.</em> {{ citation.booktitle }}, {{ citation.year }}.
        <input type="checkbox" name="citation_id" value="{{ citation.id }}" class="checkbox"> |
        <a href="/edit_citation/{{ citation.id }}"><button type="button">Edit</button></a>
      </li>
      <hr />

    {% elif citation.type == 'article' %}
      <li class="citation">
        <b>{{ citation.type }}</b> <br>
        {% if citation.tags %}
          Tags:
          {% for tag in citation.tags %}
            {{ tag }}{% if not loop.last %}, {% endif %}
          {% endfor %} <br>
        {% endif %}
        {{ citation.author }}. <em>{{ citation.title }}.</em> {{ citation.journal }}, {{ citation.year }}.
        <input type="checkbox" name="citation_id" value="{{ citation.id }}" class="checkbox"> |
        <a href="/edit_citation/{{ citation.id }}"><button type="button">Edit</button></a>
      </li>
      <hr />
    {% endif %}

    {% endfor %}
    <input type="submit" value="Delete selected citations" style="display:none" id="deleteButton">
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const deleteButton = document.getElementById("deleteButton");
      const form = document.querySelector("form.delete_citations");
      const checkbox = form.querySelectorAll("input[name='citation_id']");

      function updateDeleteButton() {
        let anyChecked = Array.from(checkbox).some(checkbox => checkbox.checked);
        if (anyChecked) {
          deleteButton.style.display = "block"; }
        else {
          deleteButton.style.display = "none";
        }}

      checkbox.forEach(checkbox => checkbox.addEventListener("change", updateDeleteButton));
      updateDeleteButton();
    });
  </script>

{% endif %}
<div>
  <a href="/bibtex"><button type="button">Get citations in BibTeX format</button></a>
</div>

{% endblock %}
